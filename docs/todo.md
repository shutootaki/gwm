# `gwm` 開発プロジェクト ToDo リスト

### フェーズ 1: 基盤構築とプロジェクトセットアップ

**目標:** 開発を開始できる状態を整え、基本的なコマンドの骨格を作る。

- [ ] **1-1. 開発環境のセットアップ**
  - [ ] Node.js, **pnpm** のバージョンを確認・統一する。
  - [ ] Git リポジトリを初期化し、`.gitignore` を設定する。

- [ ] **1-2. プロジェクトの初期化**
  - [ ] `pnpm init` を実行し、`package.json` を作成する。
  - [ ] TypeScript, Ink, React をプロジェクトにインストールする (`pnpm add typescript ink react @types/react`)。
  - [ ] TypeScript のコンフィグファイル `tsconfig.json` を設定する。

- [ ] **1-3. "Hello World" コマンドの実装**
  - [ ] Ink を使って、実行すると "Welcome to gwm!" のようなメッセージを表示するだけのシンプルなコンポーネントを作成する。
  - [ ] `package.json` の `bin` フィールドを設定し、`pnpm link --global` でローカルに `gwm` コマンドを登録し、動作を確認する。

- [ ] **1-4. コード品質ツールの導入**
  - [ ] ESLint, Prettier を導入し (`pnpm add -D eslint prettier ...`)、TypeScript 向けのルールを設定する。
  - [ ] VSCode などのエディタと連携させ、保存時に自動フォーマットがかかるようにする。

### フェーズ 2: 読み取り専用機能の実装

**目標:** 既存の worktree 情報を安全に表示する機能と、設定ファイルの読み込み機能を実装する。

- [ ] **2-1. `gwm list` コマンドの実装**
  - [ ] `child_process` モジュールを使って `git worktree list --porcelain` を実行し、その標準出力を受け取るロジックを実装する。
  - [ ] `--porcelain` 形式の出力をパースし、各 worktree のパス、ブランチ、HEAD ハッシュをオブジェクトの配列に変換するパーサーを実装する。
  - [ ] パースした情報を Ink のコンポーネント（例: `Table` コンポーネント）を使って整形し、コンソールに表示する。
  - [ ] `* ACTIVE` ステータス（カレントディレクトリが属する worktree）の判定ロジックを実装する。

- [ ] **2-2. 設定ファイル読み込み機能の実装**
  - [ ] TOML パーサーライブラリ（例: `@ltd/j-toml`）を導入する (`pnpm add @ltd/j-toml`)。
  - [ ] `~/.config/gwm/config.toml` または `~/.gwmrc` を探して読み込む機能を実装する。
  - [ ] 読み込んだ設定（`worktree_base_path`, `main_branches`）をアプリケーション内で利用できるようにする。
  - [ ] 設定ファイルが存在しない場合や、項目が欠けている場合のデフォルト値を定義する。

### フェーズ 3: Worktree 作成・操作機能の実装

**目標:** 対話的な UI を構築し、中核機能である worktree の作成と削除を実装する。

- [ ] **3-1. 対話的 UI コンポーネントの開発**
  - [ ] `ink-select-input` や `ink-text-input` などを参考に、インクリメンタルサーチ機能を持つ再利用可能なリスト選択 UI コンポーネントを開発する。

- [ ] **3-2. `gwm create` コマンドの実装**
  - [ ] **引数ありの場合:**
    - [ ] `gwm create <branch_name>` が実行された際の `git worktree add` コマンド実行ロジックを実装する。
    - [ ] 仕様書通りのパス（`~/worktrees/<repo>/<branch>`）を生成するヘルパー関数を実装する（スラッシュのハイフン変換も含む）。
    - [ ] `--from` オプションを実装し、分岐元のブランチを指定できるようにする。
  - [ ] **引数なし（対話的）の場合:**
    - [ ] `git branch -r` を実行してリモートブランチの一覧を取得する。
    - [ ] 3-1 で作成した UI を使い、ユーザーにブランチを選択させる。
    - [ ] 選択されたブランチから worktree を作成する（`-r`オプション相当のフロー）。

- [ ] **3-3. `gwm go` / `gwm code` コマンドの実装**
  - [ ] `gwm list` のロジックを流用して worktree 一覧を取得する。
  - [ ] 3-1 で作成した UI で移動先/開封先の worktree を選択させる。
  - [ ] `gwm go`: 選択された worktree のフルパスを標準出力に出力する。
  - [ ] `gwm code`: `code <path>` コマンドを実行する。`code`コマンドが見つからない場合のエラー処理も実装する。

- [ ] **3-4. `gwm remove` コマンドの実装**
  - [ ] メイン worktree を除いた一覧を、3-1 の UI で表示する。複数選択を可能にする。
  - [ ] 選択された worktree を `git worktree remove` で削除する。
  - [ ] `--force` オプションに対応する。

### フェーズ 4: 自動化と仕上げ

**目標:** `clean` コマンドを実装し、ツールの完成度を高める。

- [ ] **4-1. `gwm clean` コマンドの実装**
  - [ ] `git fetch --prune origin` を実行するロジックを組み込む。
  - [ ] 各 worktree のブランチが `main_branches` にマージ済みか判定する Git コマンドのロジックを実装する。
  - [ ] リモートで削除されたブランチを特定するロジックを実装する。
  - [ ] 上記条件に合う「削除可能 (`PRUNABLE`)」な worktree をリストアップする。
  - [ ] 削除可能リストを対話的 UI で表示し、ユーザーの選択に基づいて削除する。
  - [ ] `--yes` オプションが指定された場合、対話なしで全て削除するロジックを実装する。

- [ ] **4-2. `gwm list` の表示を完成させる**
  - [ ] 4-1 で実装した `PRUNABLE` 判定ロジックを `gwm list` にも組み込み、`STATUS` カラムの表示を仕様書通りに完成させる。
  - [ ] `git worktree lock` されている場合に `LOCKED` と表示する機能を追加する。

### フェーズ 5: 配布とドキュメント

**目標:** 誰でも使えるようにツールをパッケージ化し、ドキュメントを整備する。

- [ ] **5-1. エラーハンドリングの強化**
  - [ ] Git コマンドの実行に失敗した場合（例: Git リポジトリでないディレクトリで実行）などに、親切なエラーメッセージを表示するように全体を見直す。

- [ ] **5-2. ヘルプメッセージとドキュメント作成**
  - [ ] CLI ライブラリの機能（例: `yargs`, `commander` との連携）を使い、各コマンドに `--help` で表示される詳細な説明文を追加する。
  - [ ] `README.md` を作成し、ツールの目的、インストール方法、全コマンドの使用例、シェルの設定方法 (`wgo` 関数）などを記載する。

- [ ] **5-3. パッケージングと公開**
  - [ ] `package.json` の `repository`, `keywords`, `author` などのフィールドを整備する。
  - [ ] npm に公開するための手順を確認し、`pnpm publish` を実行する。

- [ ] **5-4. (オプション) テストコードの作成**
  - [ ] Jest や Vitest などのテストフレームワークを導入する (`pnpm add -D vitest`)。
  - [ ] Git コマンド出力のパーサーなど、純粋な関数ロジックを中心にユニットテストを作成する。
